
# Prevent directory listing and allow symbolic links for rewriting
Options -Indexes +FollowSymLinks

<IfModule mod_rewrite.c>
    RewriteEngine on

    # Block bad bots by User-Agent
    SetEnvIfNoCase User-Agent "AspiegelBot" bad_bot
    SetEnvIfNoCase User-Agent "SemrushBot" bad_bot
    SetEnvIfNoCase User-Agent "AhrefsBot" bad_bot
    SetEnvIfNoCase User-Agent "NT.*61.0.3163.100" bad_bot
    <RequireAll>
        Require all granted
        Require not env bad_bot
    </RequireAll>

    # --- EFFICIENT HTTPS & NON-WWW REDIRECT ---
    # This single block forces HTTPS and removes www in one step
    RewriteCond %{HTTPS} off [OR]
    RewriteCond %{HTTP_HOST} ^www\. [NC]
    RewriteCond %{HTTP_HOST} ^(?:www\.)?(.+)$ [NC]
    RewriteRule ^ https://%1%{REQUEST_URI} [R=301,L]

    # Your custom redirect (this is fine)
    Redirect permanent /booking.html https://www.cosmocoffee.info/booking.php

    # Block referrer spam (this is fine)
    RewriteCond %{HTTP_REFERER} google.*testing [NC]
    RewriteRule .* - [F]

    # --- phpBB Front Controller (DO NOT CHANGE) ---
    # This is required for phpBB's "pretty URLs" to work.
    # It routes requests for non-existent files/dirs to app.php.
    #
    # If phpBB is in a subdirectory, e.g. /forum/, uncomment and set the line below
    # RewriteBase /forum/
    #
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ app.php [QSA,L]
</IfModule>

# --- FILE-LEVEL SECURITY (Safer than DirectoryMatch) ---

# Block access to specific sensitive files
<Files ~ "^(config|common)\.php$">
    Require all denied
</Files>

# Block access to backup and temporary files

<FilesMatch "^\.htaccess|^\.(?!well-known)|.*\.(git|env|log|ini|conf|md|config|bak|backup|old|tmp|temp|md|ps1|py)$">
    Require all denied
</FilesMatch>
